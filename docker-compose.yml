# Copyright (c) 2018 CA. All rights reserved.
# This software may be modified and distributed under the terms
# of the MIT license.  See the LICENSE file for details.

version: '3.4'
services:
  gateway-dev:
    hostname: localhost
    image: caapim/gateway:9.4.00
    ports:
    - "8080:8080"
    - "8443:8443"
    - "8000:8000"
    volumes:
    - /opt/SecureSpan/Gateway/node/default/etc/bootstrap/services/restman
    - ./deployment/build/gateway/deployment-1.0.0.gw7:/opt/docker/rc.d/deployment.gw7
    #- ./AWS-SK/src/main/gateway/config/global-env.properties:/opt/SecureSpan/Gateway/node/default/etc/bootstrap/env/global-env.properties
    - ./Enterprise/src/main/gateway/config/global-env.properties:/opt/SecureSpan/Gateway/node/default/etc/bootstrap/env/global-env.properties
    - ./Enterprise/src/main/gateway/config/privateKeys:/opt/SecureSpan/Gateway/node/default/etc/bootstrap/env/config/privateKeys
    #- ./Enterprise/src/main/gateway/config/certificates:/opt/SecureSpan/Gateway/node/default/etc/bootstrap/certificates
    secrets:
    - source: license
      target: /opt/SecureSpan/Gateway/node/default/etc/bootstrap/license/license.xml
    environment:
      ACCEPT_LICENSE: "true"
      SSG_ADMIN_USERNAME: "admin"
      SSG_ADMIN_PASSWORD: "7layer"
      ENV.PRIVATE_KEY.ssl: '{ "keystore": "Generic", "algorithm": "RSA", "keyPassword": "7layer" }'
      ENV.CERTIFICATE.security.broadcom.com: '{
                      "verifyHostname" : false,
                      "trustedForSsl" : true,
                      "trustedAsSamlAttestingEntity" : true,
                      "trustAnchor" : true,
                      "revocationCheckingEnabled" : true,
                      "trustedForSigningClientCerts" : true,
                      "trustedForSigningServerCerts" : true,
                      "trustedAsSamlIssuer" : true
                      }'
      ENV.CERTIFICATE_FILE.security.broadcom.com.pem: |-
                        Bag Attributes
                            friendlyName: ssl
                            localKeyID: A2 A6 89 8D 36 E5 70 5A 53 59 BE 03 56 75 49 82 23 3F 31 62
                        subject=/CN=*.security.broadcom.com
                        issuer=/CN=*.security.broadcom.com
                        -----BEGIN CERTIFICATE-----
                        MIIDCTCCAfGgAwIBAgIJAKSJPvYVOTVCMA0GCSqGSIb3DQEBDAUAMCIxIDAeBgNV
                        BAMMFyouc2VjdXJpdHkuYnJvYWRjb20uY29tMB4XDTE5MDkwNjIwMTIzNloXDTI0
                        MDkwNDIwMTIzNlowIjEgMB4GA1UEAwwXKi5zZWN1cml0eS5icm9hZGNvbS5jb20w
                        ggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQClXk9KrC/l5IaSWS+lYVRT
                        tC82wYdlXZcIHqWHeKouQbnumFAQqJvx2Vd80YIrtOQSYvPfijA80B0f0bXc2/YQ
                        JTlNdm6iCEzQJUNEjj2dt9cDIoJ/PCOHI5BuEyS0b4zBnsZBxmLC8yTjyL+AoB8i
                        cnmSoF/fH63FTFMe/7nGDGibmYnvDZ3TfxmR+5mfO80gonEtopcp/Gr7fWopl63e
                        Rs4HFL2cIdKXz7WLExoAkmVdsH68FMuMpifhFBJj48rIp/7vueG7EbXnmoNPd53Q
                        dvEfSmkAxWzaUH8DSABRE3WKzaXlSreIwWxpSy196D9GWA1G2AGtiUDpIIvL3Qan
                        AgMBAAGjQjBAMB0GA1UdDgQWBBQei20AVMPWlqs5CUMM71kI3PlzXDAfBgNVHSME
                        GDAWgBQei20AVMPWlqs5CUMM71kI3PlzXDANBgkqhkiG9w0BAQwFAAOCAQEAOsCd
                        nulueLTfN6Xhy3Oac0QQSmR2uA2Q4GkFqaxNJiB/aif91MzjTiEEOymLCJA4B4dx
                        fMHjw8kcKQnUhJgQ1qht4U4awm+avImB7wbiq4xZg4opnR2VyDZgb9EAnl2uqYcl
                        DhdzeGpvQO/1x6ODu81SOO9Z+2y0D2+m7xa6xRXbLChKnhfxYq007oh/68rYxuJ4
                        eUjGHqfCzeX868aG+7XAjRLlmYRppGEAxWoAwgm3Y5haVaN/AcJ9INiwufj+VPv7
                        C9kZkjDmrALF4KtAIXSRVTXHXhqdw4HjVl25/5iJAq3+UPbHMjwUjKwVnX/mp9mr
                        CLerTH2x9q6UIMDvBg==
                        -----END CERTIFICATE-----

secrets:
  license:
    file: ./docker/license.xml